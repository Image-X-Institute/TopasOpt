<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Developer Notes &mdash; TopasOpt  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Code documentation" href="code_docs.html" />
    <link rel="prev" title="Environment set up" href="EnvironmentSetup.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> TopasOpt
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="worked_examples.html">Worked Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="next_steps.html">Next steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="EnvironmentSetup.html">Environment set up</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#additional-requirements">Additional requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packaging-instructions">Packaging instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-framework">Testing framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-documentation">Building documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-new-optimisation-algorithms">Adding new optimisation algorithms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="code_docs.html">Code documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TopasOpt</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Developer Notes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/DeveloperNotes.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="developer-notes">
<h1>Developer Notes<a class="headerlink" href="#developer-notes" title="Permalink to this heading"></a></h1>
<p>This is some ‘behind the scenes’ how to’s. Although I grandiosly called it developer notes, in reality it is so that I can remember how to update this repository in the future.</p>
<section id="additional-requirements">
<h2>Additional requirements<a class="headerlink" href="#additional-requirements" title="Permalink to this heading"></a></h2>
<p>You will need to install some additional libraries to perform the below tasks, and a currently incomplete list of these is below….</p>
<p><code class="docutils literal notranslate"><span class="pre">sphinx</span> <span class="pre">recommonmark</span> <span class="pre">sphinx_rtd_theme</span> <span class="pre">sphinx_markdown_tables</span></code></p>
<p>In the meantime, why don’t you do what I do: try to run something and install requirements based on the errors you get :-P</p>
</section>
<section id="packaging-instructions">
<h2>Packaging instructions<a class="headerlink" href="#packaging-instructions" title="Permalink to this heading"></a></h2>
<p>nb: this is mostly for me so I can remember how I did this :-P</p>
<p>Packaging for this project has been setup based on <a class="reference external" href="https://packaging.python.org/en/latest/tutorials/packaging-projects/">this tutorial</a>.
To update the distribution code, use the following commands.
Required depencies are defined in setup.cfg</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># first update version number in TopasOpt.__init__</span>

<span class="c1"># delete any existing distribution files</span>
rm -r dist
<span class="c1"># build distribution packages</span>
python -m build
<span class="c1"># upload built package</span>
python3 -m twine upload --repository testpypi dist/*  <span class="c1"># if tests</span>
twine upload dist/*  <span class="c1"># for real</span>
</pre></div>
</div>
</section>
<section id="testing-framework">
<h2>Testing framework<a class="headerlink" href="#testing-framework" title="Permalink to this heading"></a></h2>
<p>We have some test cases set up which run using <a class="reference external" href="https://www.google.com/search?channel=fs&amp;client=ubuntu&amp;q=pytest">pytest</a>. These are more like ‘integration and tests’ than unit tests, they mostly test that the code runs without errors and succesfully optimises the rosenbrock function (read more <a class="reference external" href="https://acrf-image-x-institute.github.io/TopasOpt/DevelopmentExample.html">here</a>.)</p>
<p>The tests are automatically run one someone does <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code>, but if you ever want to run them manually instructions are below:</p>
<ul class="simple">
<li><p>To run the tests, just run <code class="docutils literal notranslate"><span class="pre">pytest</span></code> from the command line at the repository root</p></li>
<li><p>To assess coverage of tests <code class="docutils literal notranslate"><span class="pre">coverage</span> <span class="pre">run</span> <span class="pre">-m</span> <span class="pre">pytest</span></code> then <code class="docutils literal notranslate"><span class="pre">coverage</span> <span class="pre">report</span></code></p></li>
<li><p>We require &gt;99% of docstrings are present. To get details stats on what doc strings are missing, run <code class="docutils literal notranslate"><span class="pre">interrogate</span> <span class="pre">../TopasOpt</span> <span class="pre">-vv</span></code></p></li>
</ul>
</section>
<section id="building-documentation">
<h2>Building documentation<a class="headerlink" href="#building-documentation" title="Permalink to this heading"></a></h2>
<p>The documentation is build from the docsrc directory by running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">github</span></code>.</p>
<p>If you want to include a new example in the documents, follow these instructions</p>
<ul class="simple">
<li><p>All of your images should be placed in docsrc/_resources/{name-of-example}</p></li>
<li><p>The rest of your example working directory should be in examples/{name-of-example} (the names do not strictly have to match but it’s probably a good idea)</p></li>
<li><p>Make sure you use relative links to point to your images, e.g. ../../docrsrc/_resources….</p></li>
<li><p>Inside docsrc, open conf.py, and update the <code class="docutils literal notranslate"><span class="pre">example_readmes</span></code> list so that your new example readme is included.</p></li>
<li><p>open worked examples rst and add your new example to the index.</p></li>
<li><p>Next step the docs are built, your readme will be included in the html</p></li>
</ul>
</section>
<section id="adding-new-optimisation-algorithms">
<h2>Adding new optimisation algorithms<a class="headerlink" href="#adding-new-optimisation-algorithms" title="Permalink to this heading"></a></h2>
<p>This library has been designed to make it easy to add new optimisation algorithms. The basic approach for a new optimiser is below</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">TopasOpt.Optimisers</span> <span class="kn">import</span> <span class="n">TopasOptBaseClass</span>   <span class="c1"># only necesary if you are not adding directly to TopasOpt.Optimisers.py</span>

<span class="k">class</span> <span class="nc">NewOptimiser</span><span class="p">(</span><span class="n">TopasOptBaseClass</span><span class="p">):</span>
    <span class="c1"># note all __init__ is handled in TopasOptBaseClass. You can see the source code for an example. You don&#39;t have to do it</span>
    <span class="c1"># exactly like this if you don&#39;t want - feel free to add your own __init__ and then use super().__init__ if you want.</span>

    <span class="k">def</span> <span class="nf">_some_supporting_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="c1"># all methods should be private except for RunOptimisation and RestartOptimisation. I prefer soft-private formalism, e.g. 		  # prefix your methods with a single underscore.</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">RunOptimisation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># public method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetUpDirectoryStructure</span><span class="p">()</span> <span class="c1"># this is needed here for every optimiser</span>
        
        <span class="c1"># the function you want to minimise is self.BlackBoxFunction, which your optimiser has inherited from TOpasOptBaseClass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BlackBoxFunction</span><span class="p">)</span>  <span class="c1"># for example</span>
        
    <span class="k">def</span> <span class="nf">RestartOptimisation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># this can be another handy public method but is not required or even possible for all optimisers.</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>If you do implement a handy new algorithm we would love you to consider making a pull request back to the main repository so it can be included in the distributed version. If you do want to do that, a few more requirements:</p>
<ul class="simple">
<li><p>Please write a tutorial demonstrating how to use your algorithm, and include it in examples/{your_algorithm}.</p></li>
<li><p>Please see ADD LINK for notes on formatting the readme and updating docsrc/conf.py to ensure the tutorial is included in the html documenation</p></li>
<li><p>Please ensure that your example has good docstring coverage, or it will fail the test framework</p></li>
<li><p>Please add a test of your optimiser to tests/test_optimisers.py - you can see the existing tests to see how to do it. You don’t have to do anything else, just adding the test is enough to ensure it will be found by ptest.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="EnvironmentSetup.html" class="btn btn-neutral float-left" title="Environment set up" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="code_docs.html" class="btn btn-neutral float-right" title="Code documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Brendan Whelan(s).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>