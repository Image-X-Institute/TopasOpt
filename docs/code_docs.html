<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Code documentation &mdash; TopasOpt  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Environment set up" href="EnvironmentSetup.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> TopasOpt
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="worked_examples.html">Worked Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="next_steps.html">Next steps (work in progress!)</a></li>
<li class="toctree-l1"><a class="reference internal" href="EnvironmentSetup.html">Environment set up</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Code documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-TopasOpt.Optimisers">Optimisers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-TopasOpt.TopasScriptGenerator">TopasScriptGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-TopasOpt.utilities">utilities</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TopasOpt</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Code documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/code_docs.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="code-documentation">
<h1>Code documentation<a class="headerlink" href="#code-documentation" title="Permalink to this headline"></a></h1>
<p>The following documentation is generated directly from the source code.
It should enable an overview of the different options which are available for
different optimisers. It is most likely to be of interest to developers, especially if I actually did a good job writing the rest of the documentation!</p>
<section id="module-TopasOpt.Optimisers">
<span id="optimisers"></span><h2>Optimisers<a class="headerlink" href="#module-TopasOpt.Optimisers" title="Permalink to this headline"></a></h2>
<p>This module contains the specific optimisation algorithms for TopasOpt. Most functionality is defined in TopasOptBaseClass,
which other optimisers inherit from.</p>
<dl class="py class">
<dt class="sig sig-object py" id="TopasOpt.Optimisers.BayesianOptimiser">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">TopasOpt.Optimisers.</span></span><span class="sig-name descname"><span class="pre">BayesianOptimiser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimisation_params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">BaseDirectory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">SimulationName</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">OptimisationDirectory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ReadMeText</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NM_StartingSimplexRelativeVal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_length_scales</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_UCBkappa</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_KappaDecayIterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">TopasLocation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'~/topas/'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ShellScriptHeader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_GP_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">KeepAllResults</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.Optimisers.BayesianOptimiser" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#TopasOpt.Optimisers.TopasOptBaseClass" title="TopasOpt.Optimisers.TopasOptBaseClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">TopasOpt.Optimisers.TopasOptBaseClass</span></code></a></p>
<p>Class to perform optimisation using the <a class="reference external" href="https://github.com/fmfn/BayesianOptimization">Bayesian Optimisation code</a>
Allowed options are defined in TopasOptBaseClass</p>
<dl class="py method">
<dt class="sig sig-object py" id="TopasOpt.Optimisers.BayesianOptimiser.RestartOptimisation">
<span class="sig-name descname"><span class="pre">RestartOptimisation</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.Optimisers.BayesianOptimiser.RestartOptimisation" title="Permalink to this definition"></a></dt>
<dd><p>Sometimes for whatever reason an optimisation is stopped prematurely.
This function allows you to restart the optimisation by loading the previous log files.
You just have to change Optimiser.RunOptimisation() to Optimiser.RestartOptimisation()
in your optimisation script; the code will do the rest automatically.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="TopasOpt.Optimisers.BayesianOptimiser.RunOptimisation">
<span class="sig-name descname"><span class="pre">RunOptimisation</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.Optimisers.BayesianOptimiser.RunOptimisation" title="Permalink to this definition"></a></dt>
<dd><p>This is the main optimisation loop.
For explanation of the various parameters and commands, start with the</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="TopasOpt.Optimisers.NelderMeadOptimiser">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">TopasOpt.Optimisers.</span></span><span class="sig-name descname"><span class="pre">NelderMeadOptimiser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimisation_params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">BaseDirectory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">SimulationName</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">OptimisationDirectory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ReadMeText</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NM_StartingSimplexRelativeVal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_length_scales</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_UCBkappa</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_KappaDecayIterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">TopasLocation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'~/topas/'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ShellScriptHeader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_GP_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">KeepAllResults</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.Optimisers.NelderMeadOptimiser" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#TopasOpt.Optimisers.TopasOptBaseClass" title="TopasOpt.Optimisers.TopasOptBaseClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">TopasOpt.Optimisers.TopasOptBaseClass</span></code></a></p>
<p>Implementation of Nelder-Mead based on scipy. Allowed options are defined in TopasOptBaseClass</p>
<dl class="py method">
<dt class="sig sig-object py" id="TopasOpt.Optimisers.NelderMeadOptimiser.RunOptimisation">
<span class="sig-name descname"><span class="pre">RunOptimisation</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.Optimisers.NelderMeadOptimiser.RunOptimisation" title="Permalink to this definition"></a></dt>
<dd><p>Use the scipy.optimize.minimize module to perform the optimisation.
Note that most of the ‘action’ is happening in BlackBoxFunction, which is repeated called by the optimiser</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="TopasOpt.Optimisers.TopasOptBaseClass">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">TopasOpt.Optimisers.</span></span><span class="sig-name descname"><span class="pre">TopasOptBaseClass</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimisation_params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">BaseDirectory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">SimulationName</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">OptimisationDirectory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ReadMeText</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NM_StartingSimplexRelativeVal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_length_scales</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_UCBkappa</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_KappaDecayIterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">TopasLocation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'~/topas/'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ShellScriptHeader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayes_GP_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">KeepAllResults</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.Optimisers.TopasOptBaseClass" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>There are many overlapping functionalities required by all optimisation algorithms: logging, calculation of objective function,
generation of models…etc. All of these common methods are contained this base class which other optimisation methods inherit.
This class is not intended to be used in isolation and won’t work if you try.
An important thing to note is that the variables from all optimisers are defined here, which means some of these options
are specific to a particular optimiser. We may find a more elegant way to handle this in future!</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>optimisation_params</strong> (<em>list</em>) – Parameters to be optimised. Must match parameters for PhaserBeamLine</p></li>
<li><p><strong>BaseDirectory</strong> (<em>string</em>) – Place where all the topas simulation results are stored</p></li>
<li><p><strong>SimulationName</strong> (<em>string</em>) – Specific folder for this simulation</p></li>
<li><p><strong>OptimisationDirectory</strong> (<em>string</em><em> or </em><em>Path</em>) – location that TopasObjectiveFunction and GenerateTopasScript are located</p></li>
<li><p><strong>ReadMeText</strong> (<em>string</em><em>, </em><em>optional</em>) – If supplied, is written to a readme file in BaseDirectory</p></li>
<li><p><strong>NM_StartingSimplexRelativeVal</strong> (<em>float</em><em>, </em><em>optional</em>) – This is a Nelder-Mead specific parameter which controls the size of the
starting simplex. A value of .1 will create a starting simplex that is spans 10% of the starting values,
which is the default behavior. If this is defined and non-Nelder-Mead optimisers are used it does nothing
(and hopefully you will be warned accordingly)</p></li>
<li><p><strong>bayes_length_scales</strong> (<em>None</em><em>, </em><em>float</em><em>, or </em><em>array</em><em> (</em><em>optional</em><em>)</em>) – Bayes-specific parameter to defined the length scales used in the gaussian process
model. If supplied to non-Bayes optimisers it does nothing (and hopefully you will be warned accordingly).
This can be supplied as one of three things: <strong>None</strong>: in this case, the default is used: length_scale=1.0
<strong>Number &gt; 0 and &lt;1</strong>: in this case, the length scales for each parameter are derived as a percentage of range.
For instance if the user enter 0.1, all length scales will be set to 10% of the range of each variable -
this is the default behavior. <strong>Array</strong>: Finally, the user is free to simply specify what length scales to use for each parameter. Make sure
you enter them in alphabetical order as this is the order used internally by the optimiser.</p></li>
<li><p><strong>bayes_UCBkappa</strong> (<em>float</em><em>, </em><em>optional</em>) – Bayes-specific parameter . kappa value in UCB  function. A higher value=more exploration. see
<a href="#id1"><span class="problematic" id="id2">`</span></a>here`_&lt;<a class="reference external" href="https://github.com/fmfn/BayesianOptimization/blob/master/examples/exploitation_vs_exploration.ipynb">https://github.com/fmfn/BayesianOptimization/blob/master/examples/exploitation_vs_exploration.ipynb</a>&gt;
for explanation</p></li>
<li><p><strong>bayes_KappaDecayIterations</strong> (<em>int</em><em>, </em><em>optional</em>) – Bayes-specific parameter. Over the last N iterations, kappa will decay to be
almost 0 (highly exploitive). For explantion of kappa decay see <a class="reference external" href="https://github.com/fmfn/BayesianOptimization/pull/221">here</a></p></li>
<li><p><strong>bayes_GP_alpha</strong> (<em>float</em><em>, </em><em>optional</em>) – Bayes-specific parameter. This parameter handles the smoothness of the gaussian process model.
for a noisy objective function, increasing this value can minimise overfitting errors.</p></li>
<li><p><strong>TopasLocation</strong> (<em>string</em><em> or </em><em>pathlib.Path</em><em>, </em><em>optional</em>) – location of topas installation. Default is ~/topas if you follow the topas instructions.</p></li>
<li><p><strong>ShellScriptHeader</strong> (<em>string</em><em>, </em><em>optional</em>) – Header to place at the start of the bash file that runs the topas model. This header
should contain all the commands you normally perform to set up your terminal environment.</p></li>
<li><p><strong>Overwrite</strong> (<em>bool</em><em>, </em><em>optional</em>) – if True, will automatically overwrite any existing files. If False, will ask first (safer)</p></li>
<li><p><strong>KeepAllResults</strong> (<em>bool</em><em>, </em><em>optional</em>) – if True, all results kept, if false, only most recent results are kept. Note that in either
case the log files contain the info from all cases, it’s just a matter of whether you want to store every iteration
which can take a lot of space</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="TopasOpt.Optimisers.TopasOptBaseClass.BlackBoxFunction">
<span class="sig-name descname"><span class="pre">BlackBoxFunction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_new</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.Optimisers.TopasOptBaseClass.BlackBoxFunction" title="Permalink to this definition"></a></dt>
<dd><p>Called Black Box function in the spirit of bayesian optimisation, this function simply takes the most recent
parameter guesses, and solves the model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="TopasOpt.Optimisers.TopasOptBaseClass.SetUpDirectoryStructure">
<span class="sig-name descname"><span class="pre">SetUpDirectoryStructure</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.Optimisers.TopasOptBaseClass.SetUpDirectoryStructure" title="Permalink to this definition"></a></dt>
<dd><p>Method to set up directory structure. This will attempt to empty the directory if it already exists.
If Overwrite=False, it will ask first, otherwise just do it.
Also writes the readme text if that exists, and copies all attributes of self to a json file.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-TopasOpt.TopasScriptGenerator">
<span id="topasscriptgenerator"></span><h2>TopasScriptGenerator<a class="headerlink" href="#module-TopasOpt.TopasScriptGenerator" title="Permalink to this headline"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="TopasOpt.TopasScriptGenerator.generate_topas_script_generator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">TopasOpt.TopasScriptGenerator.</span></span><span class="sig-name descname"><span class="pre">generate_topas_script_generator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">OutputDirectory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">TopasScriptLocation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">IncludeFileStorageDirectory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ErrorChecking</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.TopasScriptGenerator.generate_topas_script_generator" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This code will take a list topas scripts, and create a python function that returns a list for each script.
Each list element contains one line of the topas script, which can be used to automatically regenerate that script.
This class will also attempt to handle input/output lines in the topas language such as include lines and input
and output of phase space lines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>OutputDirectory</strong> (<em>string</em><em> or </em><em>pathlib.Path</em>) – location to write the returned python function to</p></li>
<li><p><strong>TopasScriptLocation</strong> (<em>string</em><em> or </em><em>pathlib.Path</em>) – location of all topas scripts which need to be recreated. Note that you do not need
to enter ‘include’ files, as these are found automatically. You only need to enter files which will be
changing on each iteration. The order of the files must match the order in which they will be run so the
code can correctly detect dynamic input/output files.</p></li>
<li><p><strong>IncludeFileStorageDirectory</strong> (<em>None</em><em> or </em><em>string</em><em> or </em><em>pathlib.Path</em><em> (</em><em>optional</em><em>)</em>) – Any included files will be copied here. This is to try and ensure the topas
scripts are portable. If no path is entered then they will be written to OutputDirectory / IncludeFiles</p></li>
<li><p><strong>ErrorChecking</strong> (<em>bool</em><em>, </em><em>optional</em>) – if True (recommended), will attempt to perform some checks on the input data.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-TopasOpt.utilities">
<span id="utilities"></span><h2>utilities<a class="headerlink" href="#module-TopasOpt.utilities" title="Permalink to this headline"></a></h2>
<p>Supporting classes and functions that don’t belong anywhere else in particular</p>
<dl class="py class">
<dt class="sig sig-object py" id="TopasOpt.utilities.FigureSpecs">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">TopasOpt.utilities.</span></span><span class="sig-name descname"><span class="pre">FigureSpecs</span></span><a class="headerlink" href="#TopasOpt.utilities.FigureSpecs" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Thought this might be the easiest way to ensure universal parameters accross all figures</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.FigureSpecs.AxisFontSize">
<span class="sig-name descname"><span class="pre">AxisFontSize</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">14</span></em><a class="headerlink" href="#TopasOpt.utilities.FigureSpecs.AxisFontSize" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.FigureSpecs.Font">
<span class="sig-name descname"><span class="pre">Font</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'serif'</span></em><a class="headerlink" href="#TopasOpt.utilities.FigureSpecs.Font" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.FigureSpecs.LabelFontSize">
<span class="sig-name descname"><span class="pre">LabelFontSize</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">14</span></em><a class="headerlink" href="#TopasOpt.utilities.FigureSpecs.LabelFontSize" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.FigureSpecs.TitleFontSize">
<span class="sig-name descname"><span class="pre">TitleFontSize</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">16</span></em><a class="headerlink" href="#TopasOpt.utilities.FigureSpecs.TitleFontSize" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="TopasOpt.utilities.PlotLogFile">
<span class="sig-prename descclassname"><span class="pre">TopasOpt.utilities.</span></span><span class="sig-name descname"><span class="pre">PlotLogFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">LogFileLoc</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.utilities.PlotLogFile" title="Permalink to this definition"></a></dt>
<dd><p>This function can be used to plot an existing log file</p>
<p>This just replicates the functionality in Optimisers.TopasOptBaseClass._Plot_Convergence and it would be
more elegant to just have one function, but that would take some refactoring.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="TopasOpt.utilities.ReadInLogFile">
<span class="sig-prename descclassname"><span class="pre">TopasOpt.utilities.</span></span><span class="sig-name descname"><span class="pre">ReadInLogFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">LogFileLoc</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.utilities.ReadInLogFile" title="Permalink to this definition"></a></dt>
<dd><p>Read in a log file and return as a dictionary</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>LogFileLoc</strong> (<em>string</em><em> or </em><em>pathlib.Path</em>) – path to log file</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="TopasOpt.utilities.WaterTankData">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">TopasOpt.utilities.</span></span><span class="sig-name descname"><span class="pre">WaterTankData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">AnalysisPath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">FileToAnalyse</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">AbsDepthDose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.utilities.WaterTankData" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Read in and analyse a series of topas scoring files in a rectangular phantom (the water tank).
There are two ways you might want to use this:</p>
<ol class="arabic simple">
<li><p>Analyse a single dose file</p></li>
<li><p>Analyse multiple dose files all on the same scoring grid</p></li>
</ol>
<p>The main attribute is the ‘DoseCube’ array. This is the agregate of all the input files. If you
only put one file in, then this is simply the agregate of that single file.
A number of plotting routines are already provided which operate on this array, but if you need to you can use
ExtractDataFromDoseCube to generate any additional data from it.</p>
<p>Basic use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">)</span>
<span class="n">AnalysisPath</span> <span class="o">=</span> <span class="n">home</span> <span class="o">+</span> <span class="s1">&#39;/Dropbox (Sydney Uni)/Projects/PhaserSims/topas/Paper_7mm_all/Results/&#39;</span>
<span class="n">FileToAnalyse</span> <span class="o">=</span> <span class="n">GetAllBinFiles</span><span class="p">(</span><span class="n">AnalysisPath</span><span class="p">)</span>
<span class="n">Dose</span> <span class="o">=</span> <span class="n">WaterTankData</span><span class="p">(</span><span class="n">AnalysisPath</span><span class="p">,</span> <span class="n">FileToAnalyse</span><span class="p">,</span> <span class="n">MirrorData</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Dose</span><span class="o">.</span><span class="n">Plot_DosePlanes</span><span class="p">()</span>
<span class="c1"># extract some additional data from agregate dose cube, XY plane for example:</span>
<span class="p">[</span><span class="n">Xpts</span><span class="p">,</span> <span class="n">Ypts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">Dose</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Dose</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
<span class="n">Zpts</span> <span class="o">=</span> <span class="n">Dose</span><span class="o">.</span><span class="n">PhantomSizeZ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Xpts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">XY_data</span> <span class="o">=</span> <span class="n">Dose</span><span class="o">.</span><span class="n">ExtractDataFromDoseCube</span><span class="p">(</span><span class="n">Xpts</span><span class="p">,</span> <span class="n">Ypts</span><span class="p">,</span> <span class="n">Zpts</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="TopasOpt.utilities.WaterTankData.ExtractDataFromDoseCube">
<span class="sig-name descname"><span class="pre">ExtractDataFromDoseCube</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Xpts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ypts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Zpts</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.utilities.WaterTankData.ExtractDataFromDoseCube" title="Permalink to this definition"></a></dt>
<dd><p>Extract data from the dose cube at positions Xpts, Ypts, Zpts
Each of these is an array or list, and they must be the same shape (they can be of any dimensionality as
they are flattened inside the function). The data is returned in the same shape as the input points.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="TopasOpt.utilities.WaterTankData.Plot_DepthDose">
<span class="sig-name descname"><span class="pre">Plot_DepthDose</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.utilities.WaterTankData.Plot_DepthDose" title="Permalink to this definition"></a></dt>
<dd><p>Plot integral depth dose curves of all beamlets</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="TopasOpt.utilities.WaterTankData.Plot_DosePlanes">
<span class="sig-name descname"><span class="pre">Plot_DosePlanes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">AddColorBar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.utilities.WaterTankData.Plot_DosePlanes" title="Permalink to this definition"></a></dt>
<dd><p>Use the DoseCube data to create a plot through each of the cardinal planes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="TopasOpt.utilities.WaterTankData.Plot_Profiles">
<span class="sig-name descname"><span class="pre">Plot_Profiles</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Zpoints</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.utilities.WaterTankData.Plot_Profiles" title="Permalink to this definition"></a></dt>
<dd><p>Plot profiles through integrated data. Can choose dir=’X’ or dir=’Y’
You can also optionally pass multiple Z points; otherwise Z is set to the middle of the phantom</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="TopasOpt.utilities.WaterTankData.Plot_XYsurface">
<span class="sig-name descname"><span class="pre">Plot_XYsurface</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Zpoints</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.utilities.WaterTankData.Plot_XYsurface" title="Permalink to this definition"></a></dt>
<dd><p>Plot XY plots for multiple Z
if Z = None, a single plot through the middle of the water phantom is produced</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="TopasOpt.utilities.bcolors">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">TopasOpt.utilities.</span></span><span class="sig-name descname"><span class="pre">bcolors</span></span><a class="headerlink" href="#TopasOpt.utilities.bcolors" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This is just here to enable me to print pretty colors to the linux terminal</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.bcolors.BOLD">
<span class="sig-name descname"><span class="pre">BOLD</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[1m'</span></em><a class="headerlink" href="#TopasOpt.utilities.bcolors.BOLD" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.bcolors.ENDC">
<span class="sig-name descname"><span class="pre">ENDC</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[0m'</span></em><a class="headerlink" href="#TopasOpt.utilities.bcolors.ENDC" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.bcolors.FAIL">
<span class="sig-name descname"><span class="pre">FAIL</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[91m'</span></em><a class="headerlink" href="#TopasOpt.utilities.bcolors.FAIL" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.bcolors.HEADER">
<span class="sig-name descname"><span class="pre">HEADER</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[95m'</span></em><a class="headerlink" href="#TopasOpt.utilities.bcolors.HEADER" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.bcolors.OKBLUE">
<span class="sig-name descname"><span class="pre">OKBLUE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[94m'</span></em><a class="headerlink" href="#TopasOpt.utilities.bcolors.OKBLUE" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.bcolors.OKCYAN">
<span class="sig-name descname"><span class="pre">OKCYAN</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[96m'</span></em><a class="headerlink" href="#TopasOpt.utilities.bcolors.OKCYAN" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.bcolors.OKGREEN">
<span class="sig-name descname"><span class="pre">OKGREEN</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[92m'</span></em><a class="headerlink" href="#TopasOpt.utilities.bcolors.OKGREEN" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.bcolors.UNDERLINE">
<span class="sig-name descname"><span class="pre">UNDERLINE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[4m'</span></em><a class="headerlink" href="#TopasOpt.utilities.bcolors.UNDERLINE" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="TopasOpt.utilities.bcolors.WARNING">
<span class="sig-name descname"><span class="pre">WARNING</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[93m'</span></em><a class="headerlink" href="#TopasOpt.utilities.bcolors.WARNING" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="TopasOpt.utilities.compare_multiple_results">
<span class="sig-prename descclassname"><span class="pre">TopasOpt.utilities.</span></span><span class="sig-name descname"><span class="pre">compare_multiple_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">BinFiles</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">abs_dose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_legend_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.utilities.compare_multiple_results" title="Permalink to this definition"></a></dt>
<dd><p>this produces depth dose and profile plots for a list of topas .bin files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>BinFiles</strong> (<em>list</em>) – list of files to analyse</p></li>
<li><p><strong>abs_dose</strong> (<em>boolean</em><em>, </em><em>optional</em>) – % dose (False) or absolute dose (True)</p></li>
<li><p><strong>custom_legend_names</strong> (<em>list</em><em>, </em><em>optional</em>) – if passed, this list will be used for legend. If not, file names will be used.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="TopasOpt.utilities.newJSONLogger">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">TopasOpt.utilities.</span></span><span class="sig-name descname"><span class="pre">newJSONLogger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TopasOpt.utilities.newJSONLogger" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">bayes_opt.logger.JSONLogger</span></code></p>
<p>To avoid the annoying behaviour where the bayesian logs get deleted on restart.
Thanks to: <a class="reference external" href="https://github.com/fmfn/BayesianOptimization/issues/159">https://github.com/fmfn/BayesianOptimization/issues/159</a></p>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="EnvironmentSetup.html" class="btn btn-neutral float-left" title="Environment set up" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Brendan Whelan(s).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>